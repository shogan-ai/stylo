(ocamllex (modules lexer))
(menhir
  (modules parser)
  (flags
    --lalr
    --unused-token COMMENT --unused-token DOCSTRING
    --unused-token EOL --unused-token GREATERRBRACKET
    --strategy simplified
    ))

(library
  (name oxcaml_frontend)
  (libraries menhirLib)
  (modules_without_implementation asttypes parsetree)
  (flags :standard -w +a-4-9-40-41-42-44-45-48-63-66-67-70))


;; Can't explicitely depend on a .cmti ...
;; So we depend on the cmi and pray for a cmti to be next to it and not stale
;;
;; Cf. https://github.com/ocaml/dune/issues/12633

(rule
  (target ast_mapper.ml)
  (deps %{cmi:parsetree} %{cmi:longident} %{cmi:asttypes}
        %{cmi:location})
  (action
    (with-stdout-to %{target}
      (run %{project_root}/parsing/gen_visitors/gen_mapper.exe %{deps}))))
